<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Working with NEON (like) Remote Sensing Time Series Data &#8211; Spatio-Temporal Data Hackathon</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Working with NEON (like) Remote Sensing Time Series Data">
<meta property="og:description" content="Hackathon held October 21-23 in Boulder, CO at NEON headquarters.">
<meta property="og:url" content="http://localhost:4000/R/ndvi/">
<meta property="og:site_name" content="Spatio-Temporal Data Hackathon">





<link rel="canonical" href="http://localhost:4000/R/ndvi/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Spatio-Temporal Data Hackathon Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">


<link rel="stylesheet" href="/assets/highlightjs/styles/zenburn.css">
<script src="/assets/highlightjs/highlight.packR.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
<div class="NEON-header">
<img src="/images/banners/header_whole.png" alt="NEON" style="width:100%;">
</div>
	<div class="site-name">
		<a href="http://localhost:4000">Spatio-Temporal Data Hackathon</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://localhost:4000/about/" >About</a></li>
		        
				<li><a href="http://localhost:4000/agenda/" >Agenda</a></li>
		        
				<li><a href="http://www.neoninc.org" target="_blank">NEON Website</a></li>
		        
				<li><a href="http://www.datacarpentry.org" target="_blank">Data Carpentry Website</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->





<div id="main" role="main">
  <div class="article-author-side">

    

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>


  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/R/ndvi/" rel="bookmark" title="Working with NEON (like) Remote Sensing Time Series Data">Working with NEON (like) Remote Sensing Time Series Data</a></h1>
      
    </div><!--/ .headline-wrap -->

    <div class="article-wrap">
      <pre><code>#work with rasters
library(raster)
#best for importing shapefiles
library(rgdal) 
#plotting
library(ggplot2)

options(stringsAsFactors = FALSE)

#set the working directory
setwd("~/Documents/data/1_DataPortal_Workshop")
</code></pre>

<h1 id="first-plot-the-basemap-to-see-where-the-tower-boundary-is">First plot the basemap to see where the tower boundary is.</h1>

<p>Note, this will require opening up the geotiff imagery for the site.
Then plotting</p>

<p>CRS: UTM ZONE 18N FOR HARVARD</p>

<pre><code>#import imagery
baseImage &lt;- stack("AOP/14060113_EH021656(20140601155722)-0263_ort.tif")

#plot the image for the site
plotRGB(baseImage,r=1,g=2,b=3, 
        main="Harvard Tower Site")

#add the shapefile 
#note: read ogr is preferred as it maintains prj info
squarePlot &lt;- readOGR("Landsat_TimeSeries/","HarClip_UTMZ18")

## OGR data source with driver: ESRI Shapefile 
## Source: "Landsat_TimeSeries/", layer: "HarClip_UTMZ18"
## with 1 features
## It has 1 fields

#add the plot boundary to the image.
plot(squarePlot, col="yellow", add=TRUE)
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/view-basemap-1.png" alt=" " /></p>

<h1 id="crop-the-base-image-to-the-aoi">Crop the Base Image to the AOI</h1>
<p>This is the area used to clip the NDVI data from. We can expand it a bit.
Concerned with size but i think a bit larger could be ok.</p>

<pre><code>#crop the image to the plot boundary?
new &lt;- crop(baseImage,squarePlot)

plotRGB(new, axes=F,main="RGB image cropped")
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/crop-image-1.png" alt=" " /></p>

<pre><code>#not sure how to add a title to plotRGB??

#export geotiff
#write the geotiff - change overwrite=TRUE to overwrite=FALSE if you want to 
#make sure you don't overwrite your files!
writeRaster(new,"new","GTiff", overwrite=TRUE)
</code></pre>

<h1 id="step-2">Step 2</h1>

<p>Import the NDVI time series.</p>

<h2 id="note-we-could-crop-these-to-a-larger-boundary-right-now-they-are-about-15mb">NOTE: we could crop these to a larger boundary. right now they are about 1.5mb</h2>
<p>##a tile…</p>

<pre><code>#define the path to write tiffs
tifPath &lt;- "Landsat_TimeSeries/D01/LS5/P12R31/2011/"

#open up the cropped files
#create list of files to make raster stack
allCropped &lt;-  list.files(tifPath, full.names=TRUE)

#create a raster stack from the list
rastStack &lt;- stack(allCropped)



#layout(matrix(c(1,1,2,3), 2, 2, byrow = TRUE))
#would like to figure out how to plot these with 2-3 in each row rather than 4
plot(rastStack, zlim=c(1500,10000),nc=3)
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/process-NDVI-images-1.png" alt=" " /></p>

<pre><code>#adjust the layout
par(mfrow=c(7,2))
#plot histograms for each image
hist(rastStack,xlim=c(1500,10000))

## Error in plot.new(): figure margins too large

#create data frame, calculate NDVI
ndvi.df &lt;- as.data.frame(matrix(-999, ncol = 2, nrow = length(allCropped)))
colnames(ndvi.df) &lt;- c("julianDays", "meanNDVI")
i &lt;- 0
for (crop in allCropped){
  i=i+1
  #open raster
  imageCrop &lt;- raster(crop)
  
  #calculate the mean of each
  ndvi.df$meanNDVI[i] &lt;- cellStats(imageCrop,mean) 
  
  #grab julian days
  ndvi.df$julianDays[i] &lt;- substr(crop,nchar(crop)-16,nchar(crop)-14)
}
</code></pre>

<h1 id="plot-ndvi-for-2011">PLOT NDVI for 2011</h1>

<p>NOTE: will add tiles for 2009-2010 - have 30 years but that is a lot!
#should we expand the extent or not?
LOOK UP:
#how to connect the dots in the NDVI ggplot??</p>

<p>Now, let’s plot NDVI for one year</p>

<pre><code>##plot stuff
#need to figure out the best plotting method to connect the dots! Or a better input format object

ggplot(ndvi.df, aes(julianDays, meanNDVI)) +
  geom_point(size=4,colour = "blue") +
  ggtitle("NDVI for 2011\nLandsat Derived") +
  xlab("Julian Days") + ylab("Mean NDVI") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/plot-mean-NDVI-1.png" alt=" " /></p>

<pre><code>#create animation ot the NDVI outputs
library(animation)

#if(!file.exists("ndvi.gif")) { # Check if the file exists
  saveGIF(
    for (i in 1:length(allCropped)) {
                      plot(rastStack[[i]],
                      main=names(rastStack[[i]]),
                      legend.lab="NDVI",
                      col=rev(terrain.colors(30)),
                      zlim=c(1500,10000) )
      }, 
    movie.name = "ndvi.gif", 
    ani.width = 300, ani.height = 300, 
    interval=.5)

## Executing: 
## 'convert' -loop 0 -delay 50 Rplot1.png Rplot2.png Rplot3.png
##     Rplot4.png Rplot5.png Rplot6.png Rplot7.png Rplot8.png
##     Rplot9.png Rplot10.png Rplot11.png Rplot12.png Rplot13.png
##     'ndvi.gif'
## Output at: ndvi.gif

## [1] TRUE

#}
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/create-animation-1.png" alt=" " /></p>

<h2 id="the-animated-gif">The animated gif!</h2>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/ndvi.gif" alt="NDVI time series animation" /></p>

<p>Time series for NDVI for 2009 at Harvard Forest</p>

<h1 id="cropping-rasters-using-shapefiles">Cropping Rasters Using Shapefiles</h1>

<pre><code>#load the imagery here. Then potentially crop it. Use as a base map
  
#load xy point for tower location - overlay on to imagery base map
  
#load the CHM here. then crop it and get average tree height
  
#load DTM hill shade -- use that as a base map??
</code></pre>

<h1 id="look-at-day-length-data-for-harvard">Look at Day Length Data for Harvard</h1>

<p>NOTE - i need to get the data from 2009-2011 to align with the Landsat Time Series</p>

<pre><code>#load the lubridate package to work with time
library(lubridate)
#readr is ideal to open fixed width files (faster than utils)
library(readr)

#read in fixed width file  
dayLengthHar2011 &lt;- read.fwf(
  file="precip_Daylength/Petersham_Mass_2011.txt",
  widths=c(8,9,9,9,9,9,9,9,9,9,9,9,9))
 
names(dayLengthHar2011) &lt;- c("Day","Jan","Feb","Mar","Apr",
                             "May","June","July","Aug","Sept",
                             "Oct","Nov","Dec") 
#open file  
#dayLengthHar2015 &lt;- read.csv(file = "precip_Daylength/Petersham_Mass_2009.txt", stringsAsFactors = FALSE)

#just pull out the columns with time information
tempDF &lt;- dayLengthHar2011[,2:13]
tempDF[] &lt;- lapply(tempDF, function(x){hm(x)$hour + hm(x)$minute/60})
#populate original DF with the new time data in decimal hours 
dayLengthHar2011[,2:13] &lt;- tempDF

#plot One MOnth of  data
ggplot(dayLengthHar2011, aes(Day, Jan)) +
  geom_point()+
  ggtitle("Day Length\nJan 2009") +
  xlab("Day of Month") + ylab("Day Length (Hours)") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/Clean-Up-Day-Length-1.png" alt=" " /></p>

<h1 id="convert-to-julian-days-and-plot">Convert to Julian Days and Plot</h1>

<p>Next, plot full year’s worth of daylength for 2011.
Note: this could be turned into a function to do multiple files.</p>

<pre><code>#convert to julian days

#stack the data frame
dayLengthHar2011.st &lt;- stack(dayLengthHar2011[2:13])
#remove NA values
dayLengthHar2011.st &lt;- dayLengthHar2011.st[complete.cases(dayLengthHar2011.st),]
#add julian days (count)
dayLengthHar2011.st$JulianDay&lt;-seq.int(nrow(dayLengthHar2011.st))
#fix names
names(dayLengthHar2011.st) &lt;- c("Hours","Month","JulianDay")

#plot Years Worth of  data
ggplot(dayLengthHar2011.st, aes(JulianDay,Hours)) +
  geom_point()+
  ggtitle("Day Length\nJan 2011") +
  xlab("Julian Days") + ylab("Day Length (Hours)") +
  theme(text = element_text(size=20))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-NDVI-daylength/plot-daylength-1.png" alt=" " /></p>





<!-- The code directly below is required to generate tags and categories at the page bottom-->



<!-- This code generates the category link at the bottom of the page-->

		
            
        

        
            
        

<!-- remove the stuff above if the site slows down - this is to populate tags -->


      <hr />
      

	
</ul>
</div>

      <footer role="contentinfo">
        <div class="article-author-bottom">
          

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>

        </div>
        <p class="byline id="post-meta"><strong>Working with NEON (like) Remote Sensing Time Series Data</strong> was 
       on <time datetime="2014-07-21T14:49:52-06:00">July 21, 2014</time> by .  <a href="http://localhost:4000/about" title="About NEON / Data Carpentry Hackathon">About NEON / Data Carpentry Hackathon</a>.</p>
      </footer>


    <!-- /.article-wrap -->

  

  </div>
  </article>
</div><!-- /#main -->



<div class="footer-wrap">
  <div class="related-articles">
  <!-- <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all activities</a>)</small></h4> -->
<h2><a>Related Content:</a></h2>

    

    

    

    

    

    

    

  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 National Ecological Observatory Network (NEON) -- Boulder, Colorado. <a href="http://www.neoninc.org" target=_blank></a>
We love feedback! Email: lwasser at neoninc.org or tweet @leahawasser .

<p>Powered by <a href="http://jekyllrb.com">Jekyll</a> A huge shot out to creator of the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</p></span>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>
