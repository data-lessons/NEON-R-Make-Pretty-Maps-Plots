<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Working with NEON (like) Met Station Time Series Data &#8211; Spatio-Temporal Data Hackathon</title>
<meta name="description" content="">
<meta name="keywords" content="">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Working with NEON (like) Met Station Time Series Data">
<meta property="og:description" content="Hackathon held October 21-23 in Boulder, CO at NEON headquarters.">
<meta property="og:url" content="http://localhost:4000/R/tower-data/">
<meta property="og:site_name" content="Spatio-Temporal Data Hackathon">





<link rel="canonical" href="http://localhost:4000/R/tower-data/">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Spatio-Temporal Data Hackathon Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="http://localhost:4000/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="http://localhost:4000/assets/js/vendor/html5shiv.min.js"></script>
	<script src="http://localhost:4000/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://localhost:4000/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">


<link rel="stylesheet" href="/assets/highlightjs/styles/zenburn.css">
<script src="/assets/highlightjs/highlight.packR.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
<div class="NEON-header">
<img src="/images/banners/header_whole.png" alt="NEON" style="width:100%;">
</div>
	<div class="site-name">
		<a href="http://localhost:4000">Spatio-Temporal Data Hackathon</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="http://localhost:4000/about/" >About</a></li>
		        
				<li><a href="http://localhost:4000/agenda/" >Agenda</a></li>
		        
				<li><a href="http://www.neoninc.org" target="_blank">NEON Website</a></li>
		        
				<li><a href="http://www.datacarpentry.org" target="_blank">Data Carpentry Website</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->





<div id="main" role="main">
  <div class="article-author-side">

    

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>


  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="http://localhost:4000/R/tower-data/" rel="bookmark" title="Working with NEON (like) Met Station Time Series Data">Working with NEON (like) Met Station Time Series Data</a></h1>
      
    </div><!--/ .headline-wrap -->

    <div class="article-wrap">
      <p>This document begins to explore approaches to handling met station collected time
series data. For the time being we are using data from the site below.</p>

<p>(http://harvardforest.fas.harvard.edu:8080/exist/apps/datasets/showData.html?id=hf001)[http://harvardforest.fas.harvard.edu:8080/exist/apps/datasets/showData.html?id=hf001]
A nice overview of time series formats in R</p>

<p>http://www.noamross.net/blog/2014/2/10/using-times-and-dates-in-râ€”presentation-code.html</p>

<h1 id="load-libraries">Load Libraries</h1>

<pre><code>#load ggplot for plotting 
library(ggplot2)
#the scales library supports breaks and formatting in ggplot
library(scales)

#don't load strings as factors
options(stringsAsFactors = FALSE)
</code></pre>

<h1 id="fix-date-function">Fix Date Function</h1>

<p>The dates natively come in - in <code>chr</code> format. We need to strip the letters and turn
it into a time class.</p>

<p><strong>Can we use a placeholder to tell it to ignore the letters??</strong></p>

<pre><code>fixDate &lt;- function(dateField,timezone){
  # Remove Characters from the dates - 2014-08-19T00:43:22Z
  # Replace T and Z with a space
  aDateField &lt;- gsub("T|Z", " ", dateField)
  
  #set the field to be a date field
  aDateField &lt;- as.POSIXct(aDateField,format = "%Y-%m-%d %H:%M:%S", 
                          tz = "GMT")
  
  #list of time zones
  #https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
  #convert to local time for pretty plotting
  attributes(aDateField)$tzone &lt;- timezone
  return(aDateField)
}

fixDateTime &lt;- function(dat,timeOne,timeTwo,tz) {
  #fix dates
  dat[,timeOne] &lt;- fixDate(dat[,timeOne],tz)
  #if there's a second time, fix that too
  if (exists("timeTwo")) {
      dat[,timeTwo] &lt;- fixDate(dat[,timeTwo],tz)
  }
  return(dat)
}
</code></pre>

<h1 id="plot-neon-data">Plot NEON data</h1>

<p>A function that deals with both the date issue (UCT to local) and plots the data.</p>

<pre><code>plotData &lt;- function(dat, xVar, yVar,plTitle,yaxTitle) {
  # dat= a dataframe containing neon data
  # nVar = the variable of interest to be plotted

  #Create the plot
  #create a quick plot of Barometric Pressure
  
  myPlot &lt;- ggplot(dat,aes_string(x=xVar, y=yVar)) +
           geom_point() +
           ggtitle(plTitle) +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Start Time") + ylab(yaxTitle)

  #format x axis with dates
  myPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))
  }
</code></pre>

<h1 id="open-and-clean-neon-data">Open and clean NEON data</h1>

<pre><code>#import barometric pressure data
harBP &lt;- read.csv("NEONdata_HarvardForest_4_2015_9_2015/bar-pressure/NEON.D01.HARV.DP1.00004.001.00000.000.025.030.BP_30min.csv")

#convert times to posix class
harBP &lt;- fixDateTime(harBP,"startDateTime","endDateTime",tz="America/New_York")


#plot the data
plotData(harBP,"startDateTime","staPresMean", 
         "NEON Barometric Pressure\nHarvard Forest",
         "Mean Barometric Pressure")

## Warning: Removed 450 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/import-data-1.png" alt=" " /></p>

<pre><code>#import single aspirated temperature data
harTemp30 &lt;- read.csv("NEONdata_HarvardForest_4_2015_9_2015/s-asp-temp/NEON.D01.HARV.DP1.00002.001.00000.000.040.030.SAAT_30min.csv")

#convert times to posix class
harTemp30 &lt;- fixDateTime(harTemp30,"startDateTime","endDateTime",tz="America/New_York")


#plot the data
#note there are missing data for May
plotData(harTemp30,"startDateTime","tempSingleMean", 
         "NEON Single Aspirated Temperature\nHarvard Forest",
         "Mean Temperature")

## Warning: Removed 3761 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/import-data-2.png" alt=" " /></p>

<pre><code>########################
#import 30 minute PARPAR
harPar30 &lt;- read.csv("NEONdata_HarvardForest_4_2015_9_2015/PAR/NEON.D01.HARV.DP1.00024.001.00000.000.060.030.PARPAR_30min.csv")

#convert times to posix class
harPar30 &lt;- fixDateTime(harPar30,"startDateTime","endDateTime",tz="America/New_York")


#plot the data
#note there are missing data for May
plotData(harPar30,"startDateTime","PARMean", 
         "NEON PAR - 30 Min\nHarvard Forest",
         "Mean PAR")

## Warning: Removed 634 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/import-data-3.png" alt=" " /></p>

<h1 id="imported-from-the-harvard-tower">Imported from the harvard tower</h1>

<p>Note - the NEON time series is not yet complete enough to review multiple years.
Thus data were downloaded from the Harvard tower.</p>

<p>http://harvardforest.fas.harvard.edu:8080/exist/apps/datasets/showData.html?id=hf001</p>

<p>NOTE: this is not NEON data - using it to have a fuller time series.</p>

<pre><code>#read in 15 min average data
harMet &lt;- read.csv(file="harvard_MetData/hf001-10-15min-m.csv")

#clean up dates
#remove the "T"
#harMet$datetime &lt;- fixDate(harMet$datetime,"America/New_York")

# Replace T and Z with a space
harMet$datetime &lt;- gsub("T|Z", " ", harMet$datetime)
  
#set the field to be a date field
harMet$datetime &lt;- as.POSIXct(harMet$datetime,format = "%Y-%m-%d %H:%M", 
                          tz = "GMT")

#list of time zones
#https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
#convert to local time for pretty plotting
attributes(harMet$datetime)$tzone &lt;- "America/New_York"

#subset out some of the data - 2010-2013 
yr.09.11 &lt;- subset(harMet, datetime &gt;= as.POSIXct('2009-01-01 00:00') &amp; datetime &lt;=
as.POSIXct('2011-01-01 00:00'))

#as.Date("2006-02-01 00:00:00")
#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11,aes(datetime, airt)) +
           geom_point() +
           ggtitle("15 min Avg Air Temperature\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))

## Warning: Removed 2 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/import-harvard-met-data-1.png" alt=" " /></p>

<pre><code># Plot PAR

myPlot &lt;- ggplot(yr.09.11,aes(datetime, parr)) +
           geom_point() +
           ggtitle("15 Min PAR\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean PAR")

#format x axis with dates
myPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))

## Warning: Removed 4 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/import-harvard-met-data-2.png" alt=" " /></p>

<h1 id="variables-available-as-daily-averages">Variables available as Daily Averages</h1>

<pre><code># Plot Precipitation
myPlot &lt;- ggplot(yr.09.11,aes(datetime, prec)) +
           geom_point() +
           ggtitle("Precipitation \nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Precip")

#format x axis with dates
myPlot + scale_x_datetime(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/plot-precip-1.png" alt=" " /></p>

<pre><code>#read in daily data
harMetDaily &lt;- read.csv(file="harvard_MetData/hf001-06-daily-m.csv")

  
#set the field to be a date field
harMetDaily$date &lt;- as.Date(harMetDaily$date, format = "%Y-%m-%d")

#subset out some of the data - 2010-2013 
yr.09.11_monAvg &lt;- subset(harMetDaily, date &gt;= as.Date('2009-01-01') &amp; date &lt;=
as.Date('2011-01-01'))

#as.Date("2006-02-01 00:00:00")
#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, airt)) +
           geom_point() +
           ggtitle("Daily Air Temperature\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/read-Daily-avg-1.png" alt=" " /></p>

<pre><code>#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, prec)) +
           geom_point() +
           ggtitle("Daily Precipitation\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Air Temperature")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/read-Daily-avg-2.png" alt=" " /></p>

<pre><code>#plot Some Air Temperature Data
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, part)) +
           geom_point() +
           ggtitle("Daily Avg Total PAR\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Total PAR")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))

## Warning: Removed 1 rows containing missing values (geom_point).
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/read-Daily-avg-3.png" alt=" " /></p>

<h1 id="plot-soil-temperature">plot soil temperature</h1>

<pre><code>#
#plot soil temp data 
  
myPlot &lt;- ggplot(yr.09.11_monAvg,aes(date, s10t)) +
           geom_point() +
           ggtitle("Daily Avg Soil Temp\nHarvard Forest") +
           theme(plot.title = element_text(lineheight=.8, face="bold",size = 20)) +
           theme(text = element_text(size=20)) +
           xlab("Time") + ylab("Mean Soil Temp")

#format x axis with dates
myPlot + scale_x_date(labels = date_format("%m/%d/%y"))
</code></pre>

<p><img src="/images/rfigs/2015-10-10-work-with-fiu-data/soil-temp-1.png" alt=" " /></p>





<!-- The code directly below is required to generate tags and categories at the page bottom-->



<!-- This code generates the category link at the bottom of the page-->

		
            
        

        
            
        

<!-- remove the stuff above if the site slows down - this is to populate tags -->


      <hr />
      

	
</ul>
</div>

      <footer role="contentinfo">
        <div class="article-author-bottom">
          

	 <img src="http://localhost:4000/images/profilePic.png" class="bio-photo" alt="NEON / Data Carpentry Hackathon bio photo"></a>



<h3>NEON / Data Carpentry Hackathon</h3>
<p>Devoted to open data and open source in science and education.</p>


<h3>Activities By Topic</h3>


  
    
      <h5><a href="/module-1">Raster and Vector Data  
    
  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
      <h5><a href="/module-2">Spatial Data Viz - Maps  
    
  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
      <h5><a href="/module-3">Time Series  
    
  
    
   
      (1) 
     </a></h5>


  
    
  
    
  
    
  
    
      <h5><a href="/module-4">Remote Sensing  
    
   
      (1) 
     </a></h5>
 

<!--
<h4><a href="/activities/">View ALL Activities</a></h4>
<h4><a href="/activities-by-tag/">Activities by Tag</a></h4>

-->
<br><br><br>









<a href="http://github.com/lwasser" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>







<br><br><br>

        </div>
        <p class="byline id="post-meta"><strong>Working with NEON (like) Met Station Time Series Data</strong> was 
       on <time datetime="2014-07-21T14:49:52-06:00">July 21, 2014</time> by .  <a href="http://localhost:4000/about" title="About NEON / Data Carpentry Hackathon">About NEON / Data Carpentry Hackathon</a>.</p>
      </footer>


    <!-- /.article-wrap -->

  

  </div>
  </article>
</div><!-- /#main -->



<div class="footer-wrap">
  <div class="related-articles">
  <!-- <h4>You might also enjoy <small class="pull-right">(<a href="http://localhost:4000/posts/">View all activities</a>)</small></h4> -->
<h2><a>Related Content:</a></h2>

    

    

    

    

    

    

    

  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 National Ecological Observatory Network (NEON) -- Boulder, Colorado. <a href="http://www.neoninc.org" target=_blank></a>
We love feedback! Email: lwasser at neoninc.org or tweet @leahawasser .

<p>Powered by <a href="http://jekyllrb.com">Jekyll</a> A huge shot out to creator of the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</p></span>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>
  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://localhost:4000/assets/js/scripts.min.js"></script>

<!-- Asynchronous Google Analytics snippet -->

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52746937-1', 'auto');
  ga('send', 'pageview');

</script>






</body>
</html>
